#
#    Copyright 2021, NTT Communications Corp.
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#

import logging
from typing import Any, Dict, List

from prompt_toolkit.shortcuts import checkboxlist_dialog

log = logging.getLogger(__name__)


def _select_family(choices: List[str]) -> List[str]:
    """Print prompt to select malware family
    """
    results_array = checkboxlist_dialog(
        title="Malware selection dialog",
        text="Select this event threats name (malware family) ?",
        values=[(choice, choice) for choice in choices]
    ).run()
    return results_array


def select_malware_from_threats(
        source_of_truth: Dict[str, Any]) -> Dict[str, Any]:
    """Node for selecting malware famly from sandbox report infromation.
    """
    family_choices = []
    for reports in source_of_truth['reports']:
        family_choices.extend(reports['threats'])
    family_name = _select_family(family_choices)
    source_of_truth['malware_family'] = family_name
    return source_of_truth
